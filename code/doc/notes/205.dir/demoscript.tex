\newcommand{\thisdocURL}{http://aips2.nrao.edu/aips++/docs/notes/202/202.html}
\newcommand{\searchURL}{../../html/aips2search.html}
\newcommand{\aipsviewURL}{../../user/aipsview/aipsview.html}
\newcommand{\GlishmanualURL}{../../reference/Glish/Glish.html}
\newcommand{\GlishtutorialURL}{../../notes/195/195.html}
\newcommand{\synthesisURL}{../../user/synthesis/synthesis.html}
\newcommand{\gsURL}{../../user/gettingstarted/gettingstarted.html}
\newcommand{\userrefmanualURL}{../../user/Refman/Refman.html}
\newcommand{\specsURL}{../../specs/specs.html}
\newcommand{\betaURL}{../beta/beta.html}
\newcommand{\consortiumURL}{../consortium.html}
%
% URL to Help system
%
\externallabels{../../user/Refman}{../../user/Refman/labels.pl}

% Add home page navigation button
%

\htmladdtonavigation{\htmladdnormallink
  {\htmladdimg{../../gif/home.gif}}{{../../html/aips++.html}}}

\section{Purpose}

The purpose of this document is to suggest interactive demonstrations
of AIPS++.

\section{General reminders}

\begin{itemize}
\item Set DISPLAY
\item Use a stable version of AIPS++, {\em e.g.} /aips++/beta
\item Ensure that the netscape is local to the machine being used or
can see the same disks
\item Work in a clean directory
\item Do a trial run!
\end{itemize}

\section{General capabilities}

\begin{itemize}
\item Say what AIPS++ is: {\bf Data, Tools, Tasks}
\item Start aips++
\item Talk about logger windows, clients. 
\begin{itemize}
\item Show options on File and Options menu. 
\item Show how help works
\begin{verbatim}
help()
help('aips')
help('display')
web()
\end{verbatim}
\item Show {\em about AIPS++} window, talk about configuration of
AIPS++ (aipsrc variables)
\end{itemize}
\item Show capabilities of Glish
\begin{itemize}
\item Simple vectors: 
\begin{verbatim}
a:=1:1000
b:=sin(pi*(a/360)^2)
print a[1:10] , b[1:10]
\end{verbatim}
\item Plotting: 
\begin{verbatim}
dp.plotxy(a, b, "Chirp")
\end{verbatim}
\item Servers and FFTs. Do a help first:
\begin{verbatim}
- help('*fft*')      

There are 10 matches. Please choose from:
  aips.mathematics.fftserverdemo
  aips.mathematics.fftservertest
  aips.mathematics.fftserver
  aips.mathematics.fftserver.complexfft
  aips.mathematics.fftserver.realtocomplexfft
  aips.mathematics.fftserver.convolve
  aips.mathematics.fftserver.crosscorr
  aips.mathematics.fftserver.autocorr
  aips.mathematics.fftserver.shift
  synthesis.synthesisdos.imagesolver.setfft
F 
- help('*fftserver')

 fftserver -- Object  -- aips.mathematics

  FFTs and related operations

 Methods
   complexfft   Full complex-to-complex in-place FFT of an array
   realtocomplexfft     Real to Complex FFT of an array
   convolve     Convolve a model with a psf
   crosscorr    Cross-correlate two real arrays
   autocorr     Auto-correlate an array
   shift        Shift an array some number of pixels with an FFT

You may find more information in the on-line documentation available
via your web browser.  Type the command

   web()

to view more about aips.mathematics.fftserver.

F 
- web()
\end{verbatim}
Now use it:
\begin{verbatim}
fft:=fftserver()
c:=fft.realtocomplexfft(b)
dp.clear()
dp.ploty(abs(c), "FT of Chirp")
\end{verbatim}
Zoom on plot to show detail.
\item tkPGPLOT. Show the plotting capabilities given by the
PGPLOT tk widget (courtesy of Martin Shepherd and Tim Pearson!)
as bound to Glish. 
\begin{verbatim}
include "pgdemo.g"
pgdemo()
\end{verbatim}
\item Aipsview. Make and display an array:
\begin{verbatim}
a:=array(1:1000, 100, 100)
dd.array(a)
\end{verbatim}
\end{itemize}
\end{itemize}


\section{Synthesis}

\begin{itemize}
\item Start a catalog browser to see the files as they are generated
\begin{verbatim}
dc.gui()
\end{verbatim}
\item Set up a MeasurementSet by using imagerdemo to set the inputs.
\begin{verbatim}
imagerdemo(T)
di.init_ms()
\end{verbatim}
\item Browse the MS. Remember to close the table. Talk about
locking of files.
\begin{verbatim}
t:=table('MS')
t.browse()
t.close()
\end{verbatim}
\item To demonstrate ad hoc processing, rescale the length
of all base-lines to antenna 4:
\begin{verbatim}
t:=table('MS', read_only=F)
t.colnames()
st:=t.query('ANTENNA1==4 || ANTENNA2==4')
st.nrows()
t.nrows()
uvw:=st.getcol('UVW')
uvw*:=0.95
st.putcol('UVW', uvw)
st.flush()
t.close();
\end{verbatim}
\item Now demonstrate the synthesis processing: first deconvolve an an image
(after re-initializing the MS).
\begin{verbatim}
di.init_ms()
di.inputs()
di.npix:=[256,256]            # Could be greater
di.npol:=4                    # I,Q,U,V images
di.weight_ms()                # Robust weighting
di.solve_clean()              # Does CLEAN only deconvolution
\end{verbatim}
\item Display it:
\begin{verbatim}
di.display()
\end{verbatim}
\item Set levels on aipsview (-0.03, 0.05 works). Go through all planes. Show the axes.
\item Now, do a selfcal.
\begin{itemize}
\item Set a threshold: 
\begin{verbatim}
di.model.threshold:=0.035
\end{verbatim}
\item Derive the model: 
\begin{verbatim}
di.derive_model()
di.derive_ft()
\end{verbatim}
\item Do the solution, setting the timescale for polarization leakage
terms to 300s (highly unfair)
\begin{verbatim}
di.D.t:=300
di.solve_cal()
\end{verbatim}
\item Repeat the deconvolution after changing the name of the output
image: 
\begin{verbatim}
di.images.restored:='restored.1'
di.solve_clean()              # Does CLEAN only deconvolution
\end{verbatim}
\item Display the image again.
\end{itemize}
\item Show a gaintable:
\begin{verbatim}
gt:=gaintable('tcal')
gt.plot()
\end{verbatim}
\end{itemize}

\section{Measures GUI}

\begin{itemize}
\item Find Local Apparent Sidereal Time from Greenwich Mean Time. First start 
measures gui:
\begin{verbatim}
include "measures.g"
dm.gui()
\end{verbatim}
\begin{itemize}
\item Select Position gui
\item Under OBS, select your observatory e.g. GB
\item Select output as IRTF
\item Press $->$Convert to convert to IRTF
\item Press $->$Frame to define this as a frame
\item Select Epoch gui under main measures gui
\item Enter the string 'today' (no quotes) in the slot on
the left
\item Select output as LAST
\item Press $->$Convert to convert to LAST (presto)
\end{itemize}
\end{itemize}

\section{Utilities}

\begin{itemize}
\item Show system information:
\begin{verbatim}
sysinfo()
sysinfo().numcpu()
sysinfo().host()
\end{verbatim}
\item GUI stuff: each one of these lines does something interesting:
\begin{verbatim}
f:=infowindow('Eat at Bodos', 'Dining recommendations') # Informative only
choicewin('Type of bagel',"plain wheat sourdough")      # Choice returned to Glish
g:=guiframework()					# Framework of GUIs
\end{verbatim}
\end{itemize}

\section{Single Dish}

\begin{itemize}
\item Load sddemo and create tables for reading
\begin{verbatim}
include 'sddemo.g'
sddemo()
\end{verbatim}
\item Start the single dish environment
\begin{verbatim}
include 'sdavg.g'
\end{verbatim}
\item Load one of the demo tables using the File menu (select Open)
\item Browse
\begin{itemize}
\item Look at a number of records and see how the plot changes
\item Look at record 65 of sddemo.table (it's bad!)
\item Select ``Browse record''
\begin{itemize}
\item Change to a different coordinate system for ``Direction'' by pushing
the button labelled ``B1950'' and selecting ``J2000'' (button label should
change).
\item Change to a different format for the Time display by pushing the
button labelled ``Time'' and selecting ``dmy''.
\item Change to a different time system by pushing the button labelled
``UTC'' and selecting ``LAST''.
\item Experiment with the other buttons (e.g. the telescope Position).
\item Display the data values by pressing the ``arr'' button.
\item Show the ns\_header and history by pressing those buttons.
\end{itemize}
\item Click on any number of other records in the ``SD Working Set Browser''
window to see them update the record browser window and the plotter.
\end{itemize}
\item Select two operations: Selection and Averaging (Operations menu).
\begin{itemize}
\item In the Record region of the selection pane, enter [1,64][66,256]
to avoid the bad record
\item Press the ``Average selected spectra'' button and look at spectrum
(result will appear in the plotter and be selected in the result manager.
\item Browse (this just brings up the individual record browser when the focus
is on an individual record).  Look at the history of this result.
\item Try different alignment and weighting options.
\item You can browse the intermediate working sets created as a result of
the selection operation.  You can browse more than one thing at a time.
\item Overlay two of these results
\begin{itemize}
\item Select one of the results in the results manager.
\item On the plotter, in the Active Plot menu, select ``2''
\item Select another of the results in the results manager.
\item On the plotter, in the Overlays menu, select ``1'' 
(overlaying will become simpler eventually)
\end{itemize}
\end{itemize}
\item Any of these results can be examined at the glish prompt.
For example, type ``print criteria1'' at the glish prompt.  This shows
the selection criteria.
\item You can rename a variable in the results manager by typing in a
new name and hitting return.
\item Now do some smoothing (turn ``off'' the other operation GUIs to
conserve real estate on your desktop)
\begin{itemize}
\item Select a record (either the result of a previous operation, or
through the browser on a working set).  This operation works on the
most recently displayed record.
\item Try different types of smoothing.
\item Try Hanning or Boxcar with and without ``decimation''
\item Do a Gaussian smooth.
\begin{itemize}
\item Select ``Gaussian''
\item Enter a width in channels
\item Convert it to x-axis units by pushing the ``Convert'' button.
\item Enter a different width.
\item Oops, you meant that to be in channels, push the menu button
labelled ``X-axis Units'' and select ``Channels'' (the value you just
typed in has not changed, but the label has).
\item Actually do the smooth.
\end{itemize}
\end{itemize}
\item Fit some baselines.
\begin{itemize}
\item Select ``Polynomial'' (sine-wave is not yet supported)
\item Choose an order.
\item Chose the x-axis ranges to include in the fit, using the plotter
\begin{itemize}
\item click on ``Range Select''
\item Mark ranges with the cursor - left mouse to start and end, right
mouse to cancel.
\item Height of a range box is 2x the local RMS, the center Y of a 
range box is the local mean.
\item Notice that these ranges are also displayed in the Baselines GUI.
\item You can convert to X-axis units in the Baselines GUI.
\item You can deselect and delete ranges in the ``Selected Ranges'' GUI.
\end{itemize}
\item With the ``Recalculate'' and ``Show'' options selected, press ``Apply''.
\item Note the chi squared in the GUI, the fit overlaying the data on the 
plotter and the original record still selected.
\item Change the order and/or the ranges
\item Ranges can be edited in the Baselines GUI entry - these changes will
noy appear on the plotter until the ``Apply'' button is pressed.
\item When you are satified that this is a baseline you want to remove,
turn off the ``Recalculate'' button and select the ``Subtract'' option
and press ``Apply''.
\end{itemize}
\item Function on data - with a record selected and plotted try the following
(comments appear after the \verb_#_), you might want to return to the original
record before each application of a function on the data.
\begin{itemize}
\item ARR*ARR  \verb_#_ square of the data array, press Apply
\item ARR * HEADER.tsys  \verb_#_ multiply by tsys in the header record
\item sqrt(ARR) \verb_#_ take the sqrt of the data
\item Any valid glish, ARR is replaced by the data array, HEADER by
the header record, NS\_HEADER by the ns\_header record, DESC by the 
desc record, and DATA by the data record.  The operations must return
an array of the same shape as the input data array.  Any global glish
variable can be used here (including functions).
\end{itemize}
\item Play with plotting options on plotting window
\item Turn on the ``Trace'' option and try some of these operations.
Note: these will eventually be equivalent to what the program is doing
at the glish level, they are only there now to illustrate the concept.
\item Select ``Open Eval Window'' from the ``Tools'' menu.
\item Type any valid glish in the eval window.
\item Press ``Eval Contents''
\item marvel at the result which appears in the glish window where you
started from.
\end{itemize}
