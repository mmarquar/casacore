#!/bin/sh

  DATADIR=`echo $AIPSPATH | awk '{print $1}'`/code/trial/data/3C273XC1
  INIT="uvfitsfiller fits=$DATADIR/3C273XC1.FITS MS=tVisibilityIterator.MS"
  if eval $INIT > $INIT_tmp.out
  then
    PROGRAM="tVisibilityIterator"
    ARGS="tVisibilityIterator.MS"
    if eval $PROGRAM $ARGS > $PROGRAM_tmp.out
    then
      if [ -f $PROGRAM.out ]
      then
        CAT=cat
      elif [ -f RCS/$PROGRAM.out,v ]
      then
        CAT='co -p -q'
      else
        echo "PASS (execution succeeded): $PROGRAM"
        STATUS=0
	rm -r tVisibilityIterator.MS
        exit
      fi
    else
      echo "FAIL (execution failure): $PROGRAM"
      rm -r tVisibilityIterator.MS
      STATUS=1
      exit
    fi
  else
     echo "FAIL (execution failure): $PROGRAM"
     rm -r tVisibilityIterator.MS
     STATUS=1
     exit
  fi
  rm -r tVisibilityIterator.MS
 
# Strip out demarked text.
  sed -e '/^>>>/,/^<<</d' $PROGRAM_tmp.out > $PROGRAM_tmp.out2
  mv -f $PROGRAM_tmp.out2 $PROGRAM_tmp.out

# Change Infinity to Inf
  sed -e 's/Infinity/Inf/g' $PROGRAM_tmp.out > $PROGRAM_tmp.out2
  mv -f $PROGRAM_tmp.out2 $PROGRAM_tmp.out

 
# Compare with the expected output.
  if $CAT $PROGRAM.out | sed -e '/^>>>/,/^<<</d' | diff $PROGRAM_tmp.out -
  then
     echo "PASS (output verified): $PROGRAM"
     STATUS=0
     exit
  else
     echo "FAIL (output not verified): $PROGRAM"
     STATUS=2
     exit
  fi
